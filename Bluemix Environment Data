Node Red Environmental data

[{"id":"8289ac15.7d765","type":"inject","z":"435dd878.bca228","name":"Data Rush","topic":"","payload":"","payloadType":"date","repeat":"300","crontab":"","once":false,"x":118,"y":356,"wires":[["9ca284d3.635d78","a5c26029.5a3da","7b7c685f.848398"]]},{"id":"d8b09756.274f68","type":"debug","z":"435dd878.bca228","name":"","active":false,"console":"false","complete":"false","x":1650.9285888671875,"y":137,"wires":[]},{"id":"9ca284d3.635d78","type":"http request","z":"435dd878.bca228","name":"","method":"GET","ret":"txt","url":"http://datapoint.metoffice.gov.uk/public/data/val/wxobs/all/xml/3772?res=hourly&key=fee30ee3-38c6-496c-a384-f0232c19b3c3","x":310.92857360839844,"y":275,"wires":[["e2eeddb0.1d112","414500e9.bebb"]]},{"id":"26c1cd98.d93e32","type":"function","z":"435dd878.bca228","name":"Split WX and DV","func":"var WX = msg.payload.SiteRep.Wx[0];\nvar DV = msg.payload.SiteRep.DV[0];\n\nvar msg1 = { payload:(WX) };\nvar msg2 = { payload:(DV) };\n\nreturn [[msg1],[msg2]];\n\n","outputs":"2","noerr":0,"x":579.9285583496094,"y":336,"wires":[[],["8447ba25.7bb848"]]},{"id":"9648254f.69b7d8","type":"debug","z":"435dd878.bca228","name":"","active":false,"console":"false","complete":"false","x":1109.9285888671875,"y":136,"wires":[]},{"id":"8447ba25.7bb848","type":"function","z":"435dd878.bca228","name":"Split Location","func":"var Location = msg.payload.Location[0]\n\nvar msg1 = { payload:(Location) };\nvar msg2 = { payload:(\"Data from Msg2\") };\n\nreturn [[msg1],[msg2]];","outputs":"2","noerr":0,"x":617.9285583496094,"y":437,"wires":[["9d656249.629aa"],[]]},{"id":"9d656249.629aa","type":"function","z":"435dd878.bca228","name":"Parse Weather","func":"/*\n<Param name=\"G\" units=\"mph\">Wind Gust</Param>\n<Param name=\"T\" units=\"C\">Temperature</Param>\n<Param name=\"V\" units=\"m\">Visibility</Param>\n<Param name=\"D\" units=\"compass\">Wind Direction</Param>\n<Param name=\"S\" units=\"mph\">Wind Speed</Param>\n<Param name=\"W\" units=\"\">Weather Type</Param>\n<Param name=\"P\" units=\"hpa\">Pressure</Param>\n<Param name=\"Pt\" units=\"Pa/s\">Pressure Tendency</Param>\n<Param name=\"Dp\" units=\"C\">Dew Point</Param>\n<Param name=\"H\" units=\"%\">Screen Relative Humidity</Param>\n*/\nvar Name = msg.payload.$.name;\nvar Country = msg.payload.$.country;\nvar Lat = msg.payload.$.lat;\nvar Long = msg.payload.$.lon;\n\nvar WindGust = \"0\"; //if wind_gust_kt is not present, value defaults to wind_speed_kt\n   if (typeof msg.payload.Period[0].Rep[0].$.G != \"undefined\") {\n\t   WindGust = msg.payload.Period[0].Rep[0].$.G[0];\n       }\nvar Temp = msg.payload.Period[0].Rep[0].$.T;\nvar Visibility = msg.payload.Period[0].Rep[0].$.V;\nvar WindDirection = msg.payload.Period[0].Rep[0].$.D;\nvar WindSpeed = msg.payload.Period[0].Rep[0].$.S;\nvar WeatherType = msg.payload.Period[0].Rep[0].$.W;\nvar Pressure = msg.payload.Period[0].Rep[0].$.P;\nvar PressureTendency = msg.payload.Period[0].Rep[0].$.Pt;\nvar DewPoint = msg.payload.Period[0].Rep[0].$.Dp;\nvar ScreenRelativeHumidity = msg.payload.Period[0].Rep[0].$.H;\n\nvar msg1 = { payload:(\"&Location = \" + Name) };\nvar msg2 = { payload:(\"&Country = \" + Country) };\nvar msg3 = { payload:(\"&\" + Name + \"= \" + Lat + \" \" + Long) };\n\nvar msg4 = { payload:(\"&\" + Name + \" Wind Gust = \" + WindGust) };\nvar msg5 = { payload:(\"&\" + Name + \" Temperature = \" + Temp) };\nvar msg6 = { payload:(\"&\" + Name + \" Visibility = \" + Visibility) };\nvar msg7 = { payload:(\"&\" + Name + \" Wind Direction = \" + WindDirection) };\nvar msg8 = { payload:(\"&\" + Name + \" Wind Speed = \" + WindSpeed) };\nvar msg9 = { payload:(\"&\" + Name + \" Weather Type = \" + WeatherType) };\nvar msg10 = { payload:(\"&\" + Name + \" Pressure = \" + Pressure) };\nvar msg11 = { payload:(\"&\" + Name + \" Pressure Tendency = \" + PressureTendency) };\nvar msg12 = { payload:(\"&\" + Name + \" Dew Point = \" + DewPoint) };\nvar msg13 = { payload:(\"&\" + Name + \" Relative Humidity = \" + ScreenRelativeHumidity) };\n\n\nreturn [[msg1],[msg2],[msg3],[msg4],[msg5],[msg6],[msg7],[msg8],[msg9],[msg10],[msg11],[msg12],[msg13]];","outputs":"13","noerr":0,"x":860.9285888671875,"y":419,"wires":[["9648254f.69b7d8"],["9648254f.69b7d8"],["9648254f.69b7d8","7697f65a.896808"],["9648254f.69b7d8","7697f65a.896808"],["9648254f.69b7d8","7697f65a.896808"],["9648254f.69b7d8","7697f65a.896808"],["9648254f.69b7d8","7697f65a.896808"],["9648254f.69b7d8","7697f65a.896808"],["9648254f.69b7d8","7697f65a.896808"],["9648254f.69b7d8","7697f65a.896808"],["9648254f.69b7d8","7697f65a.896808"],["9648254f.69b7d8","7697f65a.896808"],["9648254f.69b7d8","7697f65a.896808"]]},{"id":"e2eeddb0.1d112","type":"debug","z":"435dd878.bca228","name":"","active":false,"console":"false","complete":"false","x":590.9285583496094,"y":136,"wires":[]},{"id":"414500e9.bebb","type":"xml","z":"435dd878.bca228","name":"","attr":"","chr":"","x":429.9285583496094,"y":336,"wires":[["26c1cd98.d93e32"]]},{"id":"a5c26029.5a3da","type":"function","z":"435dd878.bca228","name":"Global Variables","func":"global.set(\"bucketid\",\"BlueMix Environmental Data\");\nglobal.set(\"apikey\",\"6UwVem6AFDvJ06bcuNkckcKl3SvhKByT\");\nglobal.set(\"AZURE_apikey\",\"wL04NBTxy4aO0oH5csFjCrDDHlzIl2DLv7adlhVRIkc\");\nglobal.set(\"AZURe_feed-id\",\"6UwVem6AFDvJ06bcuNkckcKl3SvhKByT\");\nreturn msg;","outputs":1,"noerr":0,"x":319.9285888671875,"y":176,"wires":[[]]},{"id":"aac524cf.553ad8","type":"http request","z":"435dd878.bca228","name":"IS Delivery","method":"use","ret":"txt","url":"","x":1609.9285888671875,"y":462,"wires":[["d8b09756.274f68"]]},{"id":"1a304ea1.e5cfb1","type":"function","z":"435dd878.bca228","name":"Feed to IS","func":"var apikeylocal = global.get(\"apikey\");\nvar bucketidlocal = global.get(\"bucketid\");\nvar data = {};\nmsg.method = \"GET\";\nmsg.headers = { \"X-IS-AccessKey\": apikeylocal };\nmsg.url = \"https://groker.initialstate.com/api/events?\" + \"accessKey=\" + apikeylocal + \"&bucketKey=\" + bucketidlocal + msg.payload;\nreturn msg;","outputs":1,"noerr":0,"x":1430.9285888671875,"y":463,"wires":[["aac524cf.553ad8"]]},{"id":"458fd6f6.ba7028","type":"json","z":"435dd878.bca228","name":"","x":669.9285888671875,"y":655,"wires":[["4b9790b.fb4687"]]},{"id":"4b9790b.fb4687","type":"function","z":"435dd878.bca228","name":"River Data","func":"var StationID = msg.payload.items.label;\nvar Lat = msg.payload.items.lat;\nvar Long = msg.payload.items.long;\nvar FlowReading = msg.payload.items.measures[0].latestReading.value;\nvar eaAreaName = msg.payload.items.eaAreaName;\nvar highestRecent = msg.payload.items.stageScale.highestRecent.value;\nvar latestReading = msg.payload.items.measures[1].latestReading.value;\n\nvar msg1 = { payload:(StationID) };\nvar msg2 = { payload:(\"&\" + StationID + \" m3/sec = \" + FlowReading) };\nvar msg3 = { payload:(\"&\" + StationID + \"= \" + Lat + \" \" + Long) };\nvar msg4 = { payload:(\"&\" + StationID + \" High Mtrs = \" + highestRecent) };\nvar msg5 = { payload:(\"&\" + StationID + \" Current Mtrs = \" + latestReading) };\nreturn [[msg1],[msg2],[msg3],[msg4],[msg5]];\n","outputs":"5","noerr":0,"x":852.9285888671875,"y":579,"wires":[["900ef049.6ff11"],["8f45094e.70baf8","900ef049.6ff11"],["8f45094e.70baf8","900ef049.6ff11"],["8f45094e.70baf8","900ef049.6ff11"],["900ef049.6ff11","8f45094e.70baf8"]]},{"id":"ab87b140.54785","type":"debug","z":"435dd878.bca228","name":"","active":false,"console":"false","complete":"false","x":1368.9285888671875,"y":737,"wires":[]},{"id":"8f45094e.70baf8","type":"function","z":"435dd878.bca228","name":"Aggregate Environment ","func":"\nreturn msg;","outputs":1,"noerr":0,"x":1226.9285888671875,"y":555,"wires":[["ab87b140.54785","1a304ea1.e5cfb1"]]},{"id":"7697f65a.896808","type":"function","z":"435dd878.bca228","name":"Aggregate Weather","func":"\nreturn msg;","outputs":1,"noerr":0,"x":1208.9285888671875,"y":376,"wires":[["1a304ea1.e5cfb1"]]},{"id":"da3bd406.25c428","type":"http request","z":"435dd878.bca228","name":"Request Data","method":"use","ret":"txt","url":"","x":619.9285888671875,"y":576,"wires":[["458fd6f6.ba7028"]]},{"id":"92240bb0.6ddbf8","type":"function","z":"435dd878.bca228","name":"Pull data","func":"\nvar data = {};\nmsg.method = \"GET\";\n\nmsg.url = \"http://environment.data.gov.uk/flood-monitoring/id/stations/\" + msg.payload + \".json\";\nreturn msg;","outputs":1,"noerr":0,"x":440.9285583496094,"y":575,"wires":[["da3bd406.25c428","5bf1cf49.a40e3"]]},{"id":"5bf1cf49.a40e3","type":"debug","z":"435dd878.bca228","name":"","active":false,"console":"false","complete":"false","x":488.9285583496094,"y":735,"wires":[]},{"id":"7b7c685f.848398","type":"function","z":"435dd878.bca228","name":"Site List","func":"var msg1 = { payload:(\"3400TH\") };\nvar msg2 = { payload:(\"3401TH\") };\nvar msg3 = { payload:(\"3102TH\") };\nvar msg4 = { payload:(\"2703TH\") };\nvar msg5 = { payload:(\"2702TH\") };\nreturn [[msg1],[msg2],[msg3],[msg4],[msg5]];","outputs":"5","noerr":0,"x":299.48411560058594,"y":458.5555419921875,"wires":[["92240bb0.6ddbf8"],["92240bb0.6ddbf8"],["92240bb0.6ddbf8"],["92240bb0.6ddbf8"],["92240bb0.6ddbf8"]]},{"id":"900ef049.6ff11","type":"debug","z":"435dd878.bca228","name":"","active":false,"console":"false","complete":"false","x":1068.9285888671875,"y":736,"wires":[]}]
